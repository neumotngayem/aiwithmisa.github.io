---
layout: post
title: "[LÃ½ Thuyáº¿t] BÃ i 11 CÃ¢y quyáº¿t Ä‘á»‹nh - Decision tree"
subtitle: "Loáº¡t bÃ i há»c thuá»™c series AML"
date: 2021-01-17
author: "KyoHB"
header-img: "img/post-bg-aml.jpg"
tags: [AML]
---

Trong bÃ i há»c ngÃ y hÃ´m nay chÃºng ta sáº½ tÃ¬m hiá»ƒu vá» má»™t ML model phi tuyáº¿n tÃ­nh (non-linear) cÃ³ thá»ƒ sá»­ dá»¥ng cho cáº£ bÃ i toÃ¡n phÃ¢n loáº¡i (classification) vÃ  há»“i quy (regression) Ä‘Ã³ lÃ  cÃ¢y quyáº¿t Ä‘á»‹nh - Decision tree.

## Äá»‹nh nghÄ©a vá» Decision tree

Decision tree lÃ  má»™t dáº¡ng cÃ´ng cá»¥ giÃºp há»— trá»£ cho viá»‡c Ä‘Æ°a ra quyáº¿t Ä‘á»‹nh dá»±a trÃªn mÃ´ hÃ¬nh cÃ¢y (tree-like model) quyáº¿t Ä‘á»‹nh vÃ  há»‡ quáº£. Trong decision tree, chÃºng ta sáº½ cÃ³ cÃ¡c nÃºt (node) cá»§a cÃ¢y chá»©a cÃ¡c phÃ©p so sÃ¡nh trÃªn má»™t thuá»™c tÃ­nh (attribute) vÃ  káº¿t quáº£ cá»§a phÃ©p so sÃ¡nh nÃ y sáº½ dáº«n Ä‘áº¿n cÃ¡c nhÃ¡nh (branch) há»‡ quáº£ khÃ¡c nhau. Há»‡ quáº£ cuá»‘i cÃ¹ng cá»§a má»™t nhÃ¡nh (branch) Ä‘Æ°á»£c gá»i lÃ  lÃ¡ (leaf), nÃ³ sáº½ biá»ƒu thá»‹ nhÃ³m (class) tÆ°Æ¡ng á»©ng cá»§a cÃ¡ thá»ƒ (instance) trong bÃ i toÃ¡n phÃ¢n loáº¡i (classification), hay má»™t giÃ¡ trá»‹ sá»‘ trong bÃ i toÃ¡n há»“i quy (regression).

## VÃ­ dá»¥

XÃ©t má»™t vÃ­ dá»¥ nhÆ° sau, táº­p huáº¥n luyá»‡n (training set) cá»§a chÃºng ta nhÆ° mÃ´ táº£ trong hÃ¬nh bÃªn dÆ°á»›i cÃ³ 10 cÃ¡ thá»ƒ (instance) vá»›i 3 biáº¿n khÃ´ng phá»¥ thuá»™c (independent variable) Ä‘Ã³ lÃ  hoÃ n tiá»n (refund), tÃ¬nh tráº¡ng hÃ´n nhÃ¢n (marital status), thu nháº­p chá»‹u thuáº¿ (taxable income). Biáº¿n phá»¥ thuá»™c (dependent variable) á»Ÿ Ä‘Ã¢y lÃ  cÃ³ gian láº­n (cheat) thuáº¿ hay khÃ´ng ?

![]({{ site.baseurl }}/img/in-post/aml/dt_trainingdata.png)*Source: cs.wmich.edu*
{:.image-caption}

Dá»±a vÃ o dá»¯ liá»‡u cá»§a táº­p huáº¥n luyá»‡n (training set) trÃªn, chÃºng ta cÃ³ thá»ƒ xÃ¢y dá»±ng má»™t Decision tree nhÆ° sau:

![]({{ site.baseurl }}/img/in-post/aml/dt.png)*Source: cs.wmich.edu*
{:.image-caption}

Trong hÃ¬nh trÃªn cÃ¡c Ã´ mÃ u vÃ ng chÃ­nh lÃ  nÃºt (node) cá»§a cÃ¢y, cÃ¡c Ã´ mÃ u xanh lÃ  lÃ¡ (leaf).

Giá» chÃºng ta sáº½ sá»­ dá»¥ng Decision tree nÃ y Ä‘á»ƒ phÃ¢n loáº¡i má»™t cÃ¡ thá»ƒ (instance) trong táº­p kiá»ƒm thá»­ (test set) nhÃ©. CÃ¡ thá»ƒ (instance) trong táº­p kiá»ƒm thá»­ (test set) cá»§a chÃºng ta cÃ³ sá»‘ liá»‡u nhÆ° sau:

![]({{ site.baseurl }}/img/in-post/aml/dt_testdata.png)*Source: cs.wmich.edu*
{:.image-caption}

á»¨ng tá»«ng giÃ¡ trá»‹ cá»§a cÃ¡ thá»ƒ (instance) trÃªn vÃ o Decision tree Ä‘Ã£ xÃ¢y dá»±ng, chÃºng ta sáº½ cÃ³ Ä‘Æ°á»£c suy luáº­n (deduction) ráº±ng cÃ¡ thá»ƒ (instance) nÃ y khÃ´ng gian láº­n (cheat) thuáº¿.

![]({{ site.baseurl }}/img/in-post/aml/DT_test.png)*Source: cs.wmich.edu*
{:.image-caption}

Äá»ƒ xÃ¢y dá»±ng Ä‘Æ°á»£c má»™t Decision tree nhÆ° trÃªn, trong quÃ¡ trÃ¬nh huáº¥n luyá»‡n (training) ML model, quÃ¡ trÃ¬nh quy náº¡p (induction) cÃ¢y sáº½ diá»…n ra vÃ  nÃ³ dá»±a trÃªn chiáº¿n lÆ°á»£c tham lam (greedy strategy). Trong chiáº¿n lÆ°á»£c tham lam (greedy strategy) chÃºng ta sáº½ phÃ¢n nhÃ¡nh cÃ¢y dá»±a trÃªn cÃ¡c phÃ©p so sÃ¡nh trÃªn cÃ¡c thuá»™c tÃ­nh (attribute) sao cho cÃ¡c phÃ¢n nhÃ¡nh pháº£i tá»‘i Æ°u nháº¥t theo tiÃªu chuáº©n Ä‘áº·t ra. Váº­y chÃºng ta sáº½ Ä‘Æ°a ra cÃ¡c Ä‘iá»u kiá»‡n so sÃ¡nh Ä‘á»ƒ phÃ¢n nhÃ¡nh nhÆ° nÃ o vÃ  tiÃªu chuáº©n Ä‘á»ƒ Ä‘Ã¡nh giÃ¡ phÃ¢n nhÃ¡nh ra sao ?

## PhÃ¢n nhÃ¡nh cÃ¢y

Äá»‘i vá»›i Ä‘iá»u kiá»‡n so sÃ¡nh Ä‘á»ƒ phÃ¢n nhÃ¡nh, chÃºng ta sáº½ dá»±a trÃªn 2 yáº¿u tá»‘ sau:

1. Loáº¡i thuá»™c tÃ­nh: kiá»ƒu sá»‘ (numerical value), kiá»ƒu phÃ¢n loáº¡i (categorical value)
2. Loáº¡i phÃ¢n nhÃ¡nh: PhÃ¢n nhÃ¡nh nhá»‹ phÃ¢n, Ä‘a phÃ¢n nhÃ¡nh 

Trong vÃ­ dá»¥ á»Ÿ bÃªn trÃªn chÃºng ta cÃ³ cÃ¡c biáº¿n khÃ´ng phá»¥ thuá»™c (independent variable) lÃ  hoÃ n tiá»n (refund) vÃ  tÃ¬nh tráº¡ng hÃ´n nhÃ¢n (marital status) lÃ  kiá»ƒu phÃ¢n loáº¡i (categorical value). Biáº¿n hoÃ n tiá»n (refund) do Ä‘áº·c thÃ¹ chá»‰ cÃ³ 2 loáº¡i Ä‘Ã³ lÃ  Yes vÃ  No nÃªn nÃ³ chá»‰ cÃ³ thá»ƒ phÃ¢n nhÃ¡nh nhá»‹ phÃ¢n nhÆ° sau: 

![]({{ site.baseurl }}/img/in-post/aml/dt_refund.png)

Tuy nhiÃªn Ä‘á»‘i vá»›i biáº¿n tÃ¬nh tráº¡ng hÃ´n nhÃ¢n (marital status) chÃºng ta cÃ³ tá»›i 3 loáº¡i Ä‘Ã³ lÃ : Ä‘á»™c thÃ¢n (Single), Ä‘Ã£ káº¿t hÃ´n (Married), Ä‘Ã£ ly dá»‹ (Divorced). Do Ä‘Ã³ chÃºng ta cÃ³ thá»ƒ phÃ¢n nhÃ¡nh theo cáº£ dáº¡ng nhá»‹ phÃ¢n báº±ng cÃ¡ch gá»™p cÃ¡c loáº¡i láº¡i sao cho thÃ nh 2 phÃ¢n loáº¡i lá»›n, hay Ä‘a phÃ¢n nhÃ¡nh theo tá»«ng loáº¡i. HÃ¬nh dÆ°á»›i Ä‘Ã¢y sáº½ minh há»a cÃ¡c cÃ¡ch phÃ¢n nhÃ¡nh cho biáº¿n nÃ y, trong Ä‘Ã³ hÃ¬nh bÃªn trÃ¡i lÃ  phÃ¢n nhÃ¡nh nhá»‹ phÃ¢n (Gá»™p 2 loáº¡i Single vÃ  Divorced thÃ nh 1 phÃ¢n loáº¡i lá»›n) , bÃªn pháº£i lÃ  Ä‘a phÃ¢n nhÃ¡nh.

![]({{ site.baseurl }}/img/in-post/aml/dt_marst.png)

NgoÃ i 2 biáº¿n trÃªn, táº­p dá»¯ liá»‡u (dataset) cá»§a chÃºng ta cÃ²n cÃ³ 1 biáº¿n khÃ´ng phá»¥ thuá»™c (Independent variable) dáº¡ng sá»‘ (numerical value) Ä‘Ã³ lÃ  thu nháº­p chá»‹u thuáº¿ (taxable income). Äá»‘i vá»›i cÃ¡c biáº¿n thuá»™c dáº¡ng nÃ y chÃºng ta cÃ³ 2 phÆ°Æ¡ng Ã¡n xá»­ lÃ½ nhÆ° sau:

1. Rá»i ráº¡c hÃ³a dá»¯ liá»‡u (discretization): theo dáº¡ng tÄ©nh (static) trong Ä‘Ã³ coi má»—i giÃ¡ trá»‹ lÃ  má»™t loáº¡i (category), theo dáº¡ng Ä‘á»™ng (dynamic) trong Ä‘Ã³ chia khoáº£ng (interval) giÃ¡ trá»‹ toÃ n cá»¥c ra thÃ nh tá»«ng khoáº£ng (interval) nhá» hÆ¡n, má»—i khoáº£ng (interval) nhá» nÃ y sáº½ lÃ  má»™t loáº¡i (category).
2. PhÃ¢n Ä‘á»‹nh nhá»‹ phÃ¢n (binary decision): Äáº·t ra má»™t giÃ¡ trá»‹ trong khoáº£ng (interval) giÃ¡ trá»‹ toÃ n cá»¥c lÃ m ngÆ°á»¡ng (threshold), cÃ¡c giÃ¡ trá»‹ cá»§a biáº¿n sáº½ Ä‘Æ°á»£c so sÃ¡nh nhá» hÆ¡n hoáº·c lá»›n hÆ¡n báº±ng Ä‘á»ƒ phÃ¢n nhÃ¡nh.

HÃ¬nh dÆ°á»›i Ä‘Ã¢y sáº½ minh há»a vá» 2 cÃ¡ch phÃ¢n nhÃ¡nh cho biáº¿n thu nháº­p chá»‹u thuáº¿ (taxable income), trong Ä‘Ã³ hÃ¬nh bÃªn trÃ¡i lÃ  sá»­ dá»¥ng phÆ°Æ¡ng phÃ¡p rá»i ráº¡c hÃ³a dá»¯ liá»‡u (discretization) theo dáº¡ng Ä‘á»™ng (dynamic) vÃ  bÃªn pháº£i sá»­ dá»¥ng phÆ°Æ¡ng phÃ¡p phÃ¢n Ä‘á»‹nh nhá»‹ phÃ¢n (binary decision):

![]({{ site.baseurl }}/img/in-post/aml/dt_ti.png)

## Chá»‰ sá»‘ váº¥y báº©n

Sau khi Ä‘Ã£ phÃ¢n nhÃ¡nh Ä‘Æ°á»£c thÃ nh cÃ´ng, chÃºng ta cáº§n Ä‘Ã¡nh giÃ¡ cÃ¡c phÃ¢n nhÃ¡nh Ä‘á»ƒ xem má»©c Ä‘á»™ tá»‘i Æ°u cá»§a nÃ³. Theo chiáº¿n lÆ°á»£c tham lam (greedy strategy) chÃºng ta sáº½ chá»n phÃ¢n nhÃ¡nh cÃ³ tÃ¬nh Ä‘á»“ng nháº¥t (homogeneous) cao vÃ  cÃ³ Ä‘á»™ váº¥y báº©n (impurity) tháº¥p. XÃ©t vÃ­ dá»¥ trÃªn Ä‘á»‘i vá»›i biáº¿n hoÃ n tiá»n (refund), khi phÃ¢n nhÃ¡nh theo hai loáº¡i Yes vÃ  No chÃºng ta thu Ä‘Æ°á»£c káº¿t quáº£ nhÆ° sau:

![]({{ site.baseurl }}/img/in-post/aml/dt_refund_impurity.png)

Trong Ä‘Ã³ C0 lÃ  biá»ƒu thá»‹ cá»§a nhÃ³m (class) No vÃ  C1 lÃ  biá»ƒu thá»‹ cá»§a nhÃ³m (class) Yes á»Ÿ biáº¿n phá»¥ thuá»™c (dependent variable) gian láº­n thuáº¿ (Cheat). 

CÃ³ thá»ƒ tháº¥y vá»›i nhÃ¡nh Yes, cÃ¡c cÃ¡ thá»ƒ (instance) trong táº­p huáº¥n luyá»‡n (training set) Ä‘á»u Ä‘á»“ng nháº¥t vá»›i nhau thuá»™c vá» cÃ¹ng nhÃ³m (class) C0. Tuy nhiÃªn vá»›i nhÃ¡nh No láº¡i ngÆ°á»£c láº¡i, cÃ¡c cÃ¡ thá»ƒ khÃ´ng Ä‘á»“ng nháº¥t vá»›i nhau, tá»· lá»‡ cÃ¡c thá»ƒ thuá»™c vá» 2 nhÃ³m (class) C0 vÃ  C1 gáº§n nhÆ° báº±ng nhau. Khi cÃ³ má»™t cÃ¡ thá»ƒ (instance) má»›i náº¿u nhÆ° nÃ³ cÃ³ giÃ¡ trá»‹ á»Ÿ biáº¿n hoÃ n tiá»n (refund) lÃ  Yes, chÃºng ta cÃ³ thá»ƒ kháº³ng Ä‘á»‹nh cháº¯c cháº¯n nÃ³ khÃ´ng gian láº­n thuáº¿. Máº·t khÃ¡c náº¿u cÃ¡ thá»ƒ (instance) nÃ y cÃ³ giÃ¡ trá»‹ á»Ÿ biáº¿n hoÃ n tiá»n (refund) lÃ  No, chÃºng ta khÃ³ cÃ³ thá»ƒ kháº³ng Ä‘á»‹nh Ä‘Æ°á»£c nÃ³ cÃ³ gian láº­n thuáº¿ hay khÃ´ng.

NhÆ° váº­y Ä‘á»™ váº¥y báº©n chÃ­nh lÃ  tiÃªu chuáº©n Ä‘á»ƒ Ä‘Ã¡nh giÃ¡ má»™t phÃ¢n nhÃ¡nh. Äá»ƒ tÃ­nh Ä‘á»™ váº¥y báº©n (impurity) cá»§a má»™t phÃ¢n nhÃ¡nh, chÃºng ta cÃ³ thá»ƒ sá»­ dá»¥ng 3 chá»‰ sá»‘ nhÆ° sau:

1. Gini index
2. Entropy
3. Misclassification error

**Gini index**

Gini index Ä‘Æ°á»£c tÃ­nh theo cÃ´ng thá»©c sau:

$Gini\\:index = 1 - \sum_{i=1}^{n}(P_{i}^{2})$
{:.formula}

Trong Ä‘Ã³ n tÆ°Æ¡ng á»©ng vá»›i sá»‘ nhÃ³m (class) cá»§a biáº¿n phá»¥ thuá»™c (dependent variable), $P_{i}$ tÆ°Æ¡ng á»©ng vá»›i xÃ¡c suáº¥t (probability) cá»§a nhÃ³m i. 

Láº¥y vÃ­ dá»¥ vá» káº¿t quáº£ phÃ¢n nhÃ¡nh theo loáº¡i Yes á»Ÿ biáº¿n hoÃ n tiá»n (Refund) chÃºng ta sáº½ tÃ­nh Ä‘Æ°á»£c Gini index nhÆ° sau:

$Gini\\:index = 1 - (\frac{3}{3})^{^{2}} - (\frac{0}{3})^{^{2}} = 0$
{:.formula}

Gini index káº¿t quáº£ phÃ¢n nhÃ¡nh theo loáº¡i No:

$Gini\\:index = 1 - (\frac{4}{7})^{^{2}} - (\frac{3}{7})^{^{2}} = 0.49$
{:.formula}

**Entropy**

Entropy Ä‘Æ°á»£c tÃ­nh theo cÃ´ng thá»©c sau:

$Entropy = - \sum_{i=1}^{n}(P_{i} \times log_{2}(P_{i}))$
{:.formula}

Láº¥y vÃ­ dá»¥ vá» káº¿t quáº£ phÃ¢n nhÃ¡nh theo loáº¡i Yes á»Ÿ biáº¿n hoÃ n tiá»n (refund) chÃºng ta sáº½ tÃ­nh Ä‘Æ°á»£c Entropy nhÆ° sau:

$Entropy = -(\frac{3}{3} \times log_{2}(\frac{3}{3})) - (\frac{0}{3} \times log_{2}(\frac{0}{3}))  = 0$
{:.formula}

Entropy káº¿t quáº£ phÃ¢n nhÃ¡nh theo loáº¡i No:

$Entropy = -(\frac{4}{7} \times log_{2}(\frac{4}{7})) - (\frac{3}{7} \times log_{2}(\frac{3}{7}))  = 0.985$
{:.formula}

**Misclassification error**

Misclassification error Ä‘Æ°á»£c tÃ­nh theo cÃ´ng thá»©c sau:

$Misclassification\\:error = 1 -\underset{i}{max}(P_{i})$
{:.formula}

Láº¥y vÃ­ dá»¥ vá» káº¿t quáº£ phÃ¢n nhÃ¡nh theo loáº¡i Yes á»Ÿ biáº¿n hoÃ n tiá»n (refund) chÃºng ta sáº½ tÃ­nh Ä‘Æ°á»£c Misclassification error nhÆ° sau:

$Misclassification\\:error = 1 -max(\frac{3}{3}, \frac{0}{3}) = 1 - 1 = 0$
{:.formula}

Misclassification error káº¿t quáº£ phÃ¢n nhÃ¡nh theo loáº¡i No:

$Misclassification\\:error = 1 -max(\frac{4}{7}, \frac{3}{7}) = 1 - 0.57 = 0.43$
{:.formula}

Má»™t cÃ¡ch tá»•ng quan chÃºng ta cÃ³ biá»ƒu Ä‘á»“ cho 3 chá»‰ sá»‘ mÃ´ táº£ Ä‘á»™ váº¥y báº©n (impurity) theo xÃ¡c suáº¥t cá»§a 2 nhÃ³m (class) nhÆ° sau:

![]({{ site.baseurl }}/img/in-post/aml/impurity.png)*Source: cs.wmich.edu*
{:.image-caption}

CÃ³ thá»ƒ tháº¥y cáº£ 3 chá»‰ sá»‘ Ä‘á»u cÃ³ chung Ä‘iá»ƒm cá»±c tiá»ƒu Ä‘Ã³ lÃ  á»Ÿ 0, biá»ƒu thá»‹ Ä‘á»™ váº¥y báº©n (impurity) tháº¥p nháº¥t tÆ°Æ¡ng á»©ng vá»›i cÃ¡c káº¿t quáº£ tÃ­nh Ä‘Æ°á»£c theo phÃ¢n nhÃ¡nh loáº¡i Yes á»Ÿ biáº¿n hoÃ n tiá»n (refund) Ä‘Ã£ tÃ­nh á»Ÿ trÃªn. Gini index vÃ  Misclassification error cÃ³ chung cá»±c Ä‘áº¡i Ä‘Ã³ lÃ  á»Ÿ má»©c 0.5 biá»ƒu thá»‹ Ä‘á»™ váº¥y báº©n (impurity) cao nháº¥t, trong khi Ä‘Ã³ Entropy láº¡i cá»±c Ä‘áº¡i á»Ÿ má»©c 1.

XÃ©t trÃªn máº·t tÃ­nh toÃ¡n, Entropy do trong cÃ´ng thá»©c tÃ­nh sá»­ dá»¥ng $log$ nÃªn tá»‘c Ä‘á»™ tÃ­nh toÃ¡n sáº½ cháº­m hÆ¡n 2 chá»‰ sá»‘ trÃªn. NhÆ°ng Entropy vá»›i lá»£i tháº¿ vá» biÃªn Ä‘á»™ lá»›n hÆ¡n (tá»« 0 cho Ä‘áº¿n 1) sáº½ cho Ä‘á»™ vÃ¡y báº©n (impurity) chi tiáº¿t hÆ¡n Ä‘áº·c biá»‡t lÃ  so vá»›i Misclassification error.

# Äiá»u kiá»‡n dá»«ng

Khi quy náº¡p (induction) cÃ¢y, Decision tree model sáº½ dá»±a trÃªn 3 Ä‘iá»u kiá»‡n nhÆ° sau Ä‘á»ƒ dá»«ng viá»‡c phÃ¡t triá»ƒn cÃ¢y:

1. Dá»«ng má»Ÿ rá»™ng nÃºt (node) khi táº¥t cáº£ cÃ¡c cÃ¡ thá»ƒ (instance) Ä‘Ã£ thuá»™c vá» má»™t nhÃ³m (class)
2. Dá»«ng má»Ÿ rá»™ng nÃºt (node) khi táº¥t cÃ¡c cÃ¡c tháº¿ (instace) Ä‘á»u cÃ³ chung má»™t thuá»™c tÃ­nh (attribute)
3. CÃ¡c Ä‘iá»u kiá»‡n dá»«ng sá»›m (Early termination) Ä‘Æ°á»£c Ä‘áº·t ra trÆ°á»›c khi quy náº¡p (induction) nháº±m trÃ¡nh xáº£y ra hiá»‡n tÆ°á»£ng quÃ¡ vá»«a váº·n (overfit) nhÆ° sá»‘ cÃ¡ tháº¿ (instance) tá»‘i thiá»ƒu khi phÃ¢n nhÃ¡nh, má»©c Ä‘á»™ cáº£i thiá»‡n cÃ¡c chá»‰ sá»‘ váº¥y báº©n (impurity),...

## Káº¿t

NhÆ° váº­y trong bÃ i há»c nÃ y chÃºng ta Ä‘Ã£ tÃ¬m hiá»ƒu vá» cÃ¢y quyáº¿t Ä‘á»‹nh - Decision tree vÃ  cÃ¡ch xÃ¢y dá»±ng nÃ³. Äáº·c tÃ­nh cá»§a Decision tree model náº±m á»Ÿ viá»‡c nÃ³ cÃ³ thá»ƒ phÃ¢n loáº¡i Ä‘Æ°á»£c ngay cáº£ vá»›i cÃ¡c cÃ¡ thá»ƒ (instance) cÃ³ giÃ¡ trá»‹ ngoáº¡i biÃªn vÃ  vá»›i cÃ¢y quyáº¿t Ä‘á»‹nh nhá» chÃºng ta cÃ³ thá»ƒ dá»… dÃ ng giáº£i thÃ­ch cÃ¡c quyáº¿t Ä‘á»‹nh nhÆ° vÃ­ dá»¥ trong bÃ i. á» bÃ i há»c sau chÃºng ta sáº½ thá»±c hÃ nh triá»ƒn khai xÃ¢y dá»±ng má»™t Decision tree model báº±ng Python, cÃ¡c báº¡n hÃ£y Ä‘Ã³n Ä‘á»c nhÃ© ğŸ’ª
