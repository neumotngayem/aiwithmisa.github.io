---
layout: post
title: "[LÃ½ Thuyáº¿t] BÃ i 9 PhÃ¢n loáº¡i NaÃ¯ve Bayes - NaÃ¯ve Bayes classifier"
subtitle: "Loáº¡t bÃ i há»c thuá»™c series AML"
date: 2020-12-22
author: "KyoHB"
header-img: "img/post-bg-aml.jpg"
tags: [AML]
---

Trong bÃ i há»c nÃ y chÃºng ta sáº½ tÃ¬m hiá»ƒu vá» má»™t supervised ML model phi tuyáº¿n tÃ­nh (non-linear) sá»­ dá»¥ng trong cÃ¡c bÃ i toÃ¡n phÃ¢n loáº¡i (classication) Ä‘Æ°á»£c gá»i lÃ  phÃ¢n loáº¡i NaÃ¯ve Bayes.


## PhÃ¢n phá»‘i chuáº©n - Normal distribution

Äáº§u tiÃªn chÃºng ta cÃ¹ng Ã´n láº¡i vá» phÃ¢n phá»‘i chuáº©n (Normal distribution / Gaussian distribution). PhÃ¢n phá»‘i chuáº©n sáº½ cho ra má»™t biá»ƒu Ä‘á»“ máº­t Ä‘á»™ xÃ¡c suáº¥t (probability density plot) nhÆ° sau:

![]({{ site.baseurl }}/img/in-post/aml/normal_distri.png)


Nhá»¯ng Ä‘áº·c trÆ°ng cá»§a biá»ƒu Ä‘á»“ nÃ y Ä‘Ã³ lÃ  nÃ³ cÃ³ hÃ¬nh chuÃ´ng (bell curve), Ä‘á»‘i xá»©ng qua giÃ¡ trá»‹ trung bÃ¬nh (mean) $\mu$. ChÃºng ta cÃ³ hÃ m sá»‘ máº­t Ä‘á»™ xÃ¡c xuáº¥t (probability density function) Ä‘á»ƒ tÃ­nh máº­t Ä‘á»™ xÃ¡c xuáº¥t (probability density) cá»§a má»™t biáº¿n $x$ lÃ  $P(x)$ trong má»™t phÃ¢n phá»‘i chuáº©n (normal distribution) nhÆ° sau:

$P(x) = \frac{e^{-(x - \mu)^{2}/(2\sigma^{2}) }} {\sigma\sqrt{2\pi}}$
{:.formula}

Trong Ä‘Ã³ $\mu$ lÃ  gÃ¬ trá»‹ trung bÃ¬nh (mean), $\sigma^{2}$ lÃ  phÆ°Æ¡ng sai (variance)

## Äá»‹nh lÃ½ Bayes - Bayes Theorem

XÃ©t trong má»™t bÃ i toÃ¡n á»Ÿ trÆ°á»ng trong Ä‘Ã³ chÃºng ta muá»‘n váº½ biá»ƒu Ä‘á»“ máº­t Ä‘á»™ xÃ¡c xuáº¥t (probability density plot) vá» chiá»u cao cá»§a nhÃ³m há»c sinh nam vÃ  ná»¯, chÃºng ta cÃ³ thá»ƒ thu tháº­p vÃ  tÃ­nh máº­t Ä‘á»™ xÃ¡c xuáº¥t (probability density) cá»§a má»™t chiá»u cao $x$  trá»±c quan theo cÃ´ng thá»©c sau:

$P(x) = \frac{Sá»‘\\:lÆ°á»£ng\\:há»c\\:sinh\\:cÃ¹ng\\:nhÃ³m,\\:cÃ¹ng\\:chiá»u\\:cao}{Tá»•ng\\:sá»‘\\:há»c\\:sinh\\:thuá»™c\\:nhÃ³m\\:Ä‘Ã³}$
{:.formula}

Biá»u Ä‘á»“ máº­t Ä‘á»™ xÃ¡c xuáº¥t (probability density plot) cá»§a chÃºng ta khi áº¥y sáº½ nhÆ° sau:

![]({{ site.baseurl }}/img/in-post/aml/prob_1.png)

Dá»±a vÃ o biá»ƒu Ä‘á»“ xÃ¡c xuáº¥t trÃªn chÃºng ta cÃ³ thá»ƒ biáº¿t kháº£ nÄƒng (likelihood) cá»§a chiá»u cao má»™t há»c sinh cho biáº¿t nhÃ³m cá»§a há»c sinh Ä‘Ã³ (Nam hoáº·c Ná»¯) Ä‘Æ°á»£c kÃ½ hiá»‡u lÃ  $P(x\|c)$ trong Ä‘Ã³ $x$ lÃ  chiá»u cao, $c$ lÃ  nhÃ³m há»c sinh.


![]({{ site.baseurl }}/img/in-post/aml/prob_2.png)


Trong biá»u Ä‘á»“ máº­t Ä‘á»™ xÃ¡c xuáº¥t (probability density plot) trÃªn vÃ¹ng mÃ  cáº£ cá»§a 2 nhÃ³m gá»‘i (overlap) lÃªn nhau chÃºng ta cÃ³ $P(155 | Ná»¯) = 0.35$  vÃ  $P(155 | Nam) = 0.2$ nhÆ° váº­y náº¿u chÃºng ta cÃ³ má»™t há»c sinh cao 1m55 thÃ¬ há»c sinh nÃ y cÃ³ thá»ƒ lÃ  nam hoáº·c ná»¯ nhÆ°ng cÃ³ kháº£ nÄƒng (likelihood) há»c sinh Ä‘Ã³ lÃ  ná»¯ cao hÆ¡n.
Náº¿u xÃ©t sang nhá»¯ng vÃ¹ng khÃ´ng gá»‘i lÃªn nhau (overlap) nhÆ° chiá»u cao cá»§a há»c sinh Ä‘Ã³ lÃ  1m7 thÃ¬ kháº£ nÄƒng (likelihood) há»c sinh Ä‘Ã³ lÃ  nam sáº½ nhiá»u hÆ¡n.

Tá»« Ä‘Ã¢y chÃºng ta cÃ³ thá»ƒ mÆ°á»ng tÆ°á»£ng ráº±ng náº¿u chÃºng ta cÃ³ thá»ƒ tÃ­nh Ä‘Æ°á»£c xÃ¡c suáº¥t cá»§a má»™t cÃ¡ thá»ƒ (instance) thuá»™c nhÃ³m $c$ cho biáº¿t biáº¿n khÃ´ng phá»¥ thuá»™c $x$ - $P(c\|x)$. Dá»±a vÃ o xÃ¡c suáº¥t nÃ y chÃºng ta sáº½ phÃ¢n loáº¡i Ä‘Æ°á»£c Ä‘á»‘i tÆ°á»£ng. Äá»‹nh lÃ½ Bayesian (Bayesian Theorem) cho chÃºng ta cÃ´ng thá»©c (formula) sau:

$P(c\|x)=\frac{P(x\|c)P(c)}{P(x)}$
{:.formula}

Trong Ä‘Ã³ $P(c\|x)$ Ä‘Æ°á»£c gá»i lÃ  xÃ¡c suáº¥t háº­u nghiá»‡m (posterior probability), $P(x\|c)$ Ä‘Æ°á»£c gá»i lÃ  kháº£ nÄƒng (likelihood), $P(c)$ Ä‘Æ°á»£c gá»i lÃ  xÃ¡c suáº¥t nhÃ³m tiÃªn nghiá»‡m (class prior probability) vÃ  $P(x)$ lÃ  xÃ¡c suáº¥t dá»± Ä‘oÃ¡n tiÃªn nghiá»‡m (predictor prior probability)

Trong Ä‘Ã³ $P(x\|c)$ - kháº£ nÄƒng (likelihood) Ä‘Ã£ Ä‘Æ°á»£c nháº¯c Ä‘áº¿n á»Ÿ trÃªn, cÃ²n hai xÃ¡c suáº¥t tiÃªn nghiá»‡m kia lÃ  gÃ¬ ?

1. XÃ¡c suáº¥t nhÃ³m tiÃªn nghiá»‡m (class prior probability) $P(c)$: cho biáº¿t xÃ¡c suáº¥t cá»§a nhÃ³m Ä‘Ã³ trong quáº§n thá»ƒ (population). VÃ­ dá»¥ nhÆ° trÆ°á»ng há»c trÃªn cÃ³ 40% lÃ  ná»¯ vÃ  60% lÃ  nam chÃºng ta sáº½ cÃ³ $P(Nam)$ = 0.6 vÃ  $P(Ná»¯)$ = 0.4
2. XÃ¡c suáº¥t dá»± Ä‘oÃ¡n tiÃªn nghiá»‡m (predictor prior probability) $P(x)$: cho biáº¿t xÃ¡c suáº¥t cá»§a cÃ¡ thá»ƒ Ä‘Ã³ trong quáº§n thá»ƒ (population). VÃ­ dá»¥ $P(155)$ lÃ  sá»‘ há»c sinh cao 1m55 trÃªn toÃ n bá»™ sá»‘ há»c sinh cá»§a trÆ°á»ng (khÃ´ng phÃ¢n biá»‡t nhÃ³m).

Quay trá»Ÿ vá» vá»›i bÃ i toÃ¡n ban Ä‘áº§u, chÃºng ta sáº½ tÃ­nh $P(Nam\|155)$ vÃ  $P(Ná»¯\|155)$ dá»±a trÃªn Ä‘á»‹nh lÃ½ Bayes (Bayes Theorem) nhÃ©:

$P(Nam\|155)=\frac{P(155\|Nam)P(Nam)}{P(155)} =\frac{0.2\times 0.6}{P(155)}=\frac{0.12}{P(155)}$
{:.formula}

$P(Ná»¯\|155)=\frac{P(155\|Ná»¯)P(Ná»¯)}{P(155)}=\frac{0.35\times 0.4}{P(155)}=\frac{0.14}{P(155)}$
{:.formula}

VÃ¬ chÃºng ta chá»‰ quan tÃ¢m Ä‘áº¿n Ä‘á»™ lá»›n cá»§a $P(Nam\|155)$ vÃ  $P(Ná»¯\|155)$ xem bÃªn nÃ o cÃ³ xÃ¡c suáº¥t lá»›n hÆ¡n, nÃªn chÃºng ta cÃ³ thá»ƒ loáº¡i bá» pháº§n máº«u sá»‘ $P(155)$ á»Ÿ Ä‘Ã¢y vÃ  cÅ©ng nhÆ° á»Ÿ nhá»¯ng bÃ i toÃ¡n tiáº¿p theo. CÃ³ thá»ƒ tháº¥y $P(Ná»¯\|155)$ lá»›n hÆ¡n $P(Nam\|155)$ má»™t chÃºt xÃ­u nÃªn náº¿u má»™t há»c sinh cÃ³ chiá»u cao lÃ  1m55 chÃºng ta cÃ³ thá»ƒ phÃ¢n loáº¡i há»c sinh nÃ y lÃ  ná»¯.

## Giáº£ Ä‘á»‹nh NaÃ¯ve - NaÃ¯ve Assumption

Trong trÆ°á»ng há»£p chÃºng ta cÃ³ nhiá»u hÆ¡n má»™t biáº¿n khÃ´ng phá»¥ thuá»™c (independent variable) x, nhÆ° khÃ´ng chá»‰ chiá»u cao cá»§a há»c sinh chÃºng ta cÃ³ cáº£ cá»¡ giÃ y, sáº£i tay,... ChÃºng ta sáº½ tÃ­nh $P(x\|c)$ trong trÆ°á»ng há»£p Ä‘Ã³ nhÆ° nÃ o ? Khi Ä‘Ã³ chÃºng ta sáº½ Ã¡p dá»¥ng giáº£ Ä‘á»‹nh (assumption) NaÃ¯ve, trong Ä‘Ã³ cÃ¡c biáº¿n khÃ´ng phá»¥ thuá»™c (independent variable) nÃ y lÃ  Ä‘á»™c láº­p vá»›i nhau, tá»« Ä‘Ã³:

$P(x\|c) = P(x_{1}\|c)\times P(x_{2}\|c)\times P(x_{3}\|c)\times...\times P(x_{n}\|c)$
{:.formula}

Trong Ä‘Ã³ n lÃ  sá»‘ biáº¿n khÃ´ng phá»¥ thuá»™c (independent variable)

Káº¿t há»£p vá»›i Ä‘á»‹nh lÃ½ Bayes á»Ÿ trÃªn, chÃºng ta sáº½ cÃ³ cÃ´ng thá»©c (formula) nhÆ° sau:

$P(c\|x_{1},x_{2},x_{3},...x_{n})\propto P(x_{1}\|c)P(x_{2}\|c)P(x_{3}\|c)...P(x_{n}\|c)P(c)$
{:.formula}

Trong Ä‘Ã³ $\propto$ lÃ  tá»‰ lá»‡ (proportion) vá»›i 

ÄÃ¢y lÃ  cÃ´ng thá»©c Ä‘Æ°á»£c sá»­ dá»¥ng trong phÃ¢n loáº¡i NaÃ¯ve Bayes (NaÃ¯ve Bayes classifier). 

Má»™t cÃ¡ch tá»•ng quÃ¡t hÃ³a trong phÃ¢n loáº¡i NaÃ¯ve Bayes (NaÃ¯ve Bayes classifier) chÃºng ta sáº½ tÃ­nh cÃ¡c tÃ­ch á»Ÿ pháº§n tá»­ sá»‘, vÃ  tÃ¬m xem nhÃ³m (class) $c$ nÃ o cÃ³ pháº§n tá»­ sá»‘ lá»›n nháº¥t (vÃ¬ pháº§n máº«u sá»‘ luÃ´n báº±ng nhau giá»¯a cÃ¡c nhÃ³m). ChÃºng Ä‘Æ°á»£c viáº¿t láº¡i theo cÃ´ng thá»©c toÃ¡n há»c nhÆ° sau:

$\hat{c} = \underset{c}{arg max}P(c)\prod_{i=1}^{n}P(x_{i}\|c)$
{:.formula}

Trong Ä‘Ã³ $\hat{c}$ lÃ  nhÃ³m dá»± Ä‘oÃ¡n, $\underset{c}{arg max}$ lÃ  tÃ¬m Ä‘á»‘i sá»‘ (argument) nhÃ³m (class) c cho káº¿t quáº£ hÃ m sá»‘ (function) lá»›n nháº¥t.

## VÃ­ dá»¥

ChÃºng ta cÃ³ má»™t báº£ng thá»‘ng kÃª cÃ¡c thÃ´ng sá»‘ thá»i tiáº¿t bao gá»“m quang cáº£nh (outlook), nhiá»‡t Ä‘á»™ (temparature), Ä‘á»™ áº©m (humidity), giÃ³ (windy) vÃ  biáº¿n phá»¥ thuá»™c (dependent variable) á»Ÿ Ä‘Ã¢y lÃ  cÃ³ hoáº·c khÃ´ng chÆ¡i tennis.

![]({{ site.baseurl }}/img/in-post/aml/example_naive.png)

XÃ©t trong Ä‘iá»u kiá»‡n nhÆ° sau: quang cáº£nh lÃ  náº¯ng (sunny), nhiá»‡t Ä‘á»™ lÃ  66, Ä‘á»™ áº©m lÃ  90, cÃ³ giÃ³ thÃ¬ cÃ³ chÆ¡i tennis khÃ´ng ? ChÃºng ta sáº½ Ã¡p dá»¥ng phÃ¢n loáº¡i NaÃ¯ve Bayes Ä‘á»ƒ quyáº¿t Ä‘á»‹nh nhÃ© !

Äáº§u tiÃªn chÃºng ta sáº½ tÃ­nh xÃ¡c suáº¥t cÃ³ chÆ¡i tennis trong Ä‘iá»u kiá»‡n trÃªn:

$P(out = sunny\|Yes) = \frac{2}{9}$
{:.formula}

$P(wind = true\|Yes) = \frac{3}{9}$
{:.formula}

Äá»‘i vá»›i cÃ¡c biáº¿n dáº¡ng sá»‘ (numerical variable) chÃºng ta sáº½ sá»­ dá»¥ng phÃ¢n phá»‘i chuáº©n (normal distribution) Ä‘á»ƒ tÃ­nh kháº£ nÄƒng (likelihood) nhÆ° sau: 

$P(temp = 66\|Yes) = \frac{e^{-(66 - \mu)^{2}/(2\sigma^{2}) }} {\sigma\sqrt{2\pi}} = \frac{e^{-(66 - 73)^{2}/(2\times 6.2^{2}) }} {6.2\sqrt{2\pi}} = 0.034$
{:.formula}
$P(hum = 90\|Yes) = \frac{e^{-(90 - \mu)^{2}/(2\sigma^{2}) }} {\sigma\sqrt{2\pi}} = \frac{e^{-(90 - 79.1)^{2}/(2\times 10.2^{2}) }} {10.2\sqrt{2\pi}} = 0.0221$
{:.formula}


$P(Yes \| out=sunny, temp=66, hum=90, wind=true)$
$\propto P(out = sunny\|Yes) \times P(temp = 66\|Yes) \times P(hum = 90\|Yes) \times P(wind = true\|Yes) \times P(Yes)$
$\propto  \frac{2}{9} \times 0.034 \times 0.0221 \times \frac{3}{9} \times \frac{9}{14}$

$\propto 0.000036$

TÆ°Æ¡ng tá»± vá»›i xÃ¡c suáº¥t khÃ´ng chÆ¡i tennis trong Ä‘iá»u kiá»‡n trÃªn:

$P(No \| out=sunny, temp=66, hum=90, wind=true)$
$\propto P(out = sunny\|No) \times P(temp = 66\|No) \times P(hum = 90\|No) \times P(wind = true\|No) \times P(No)$
$\propto  \frac{3}{5} \times 0.0291 \times 0.038 \times \frac{3}{5} \times \frac{5}{14}$

$\propto 0.000136$

Do $P(Yes \| out=sunny, temp=66, hum=90, wind=true) < P(No \| out=sunny, temp=66, hum=90, wind=true)$ nÃªn trong Ä‘iá»u kiá»‡n trÃªn sáº½ khÃ´ng chÆ¡i tennis.

## Laplace Smoothing

Náº¿u Ä‘á»ƒ Ã½ á»Ÿ báº£ng sá»‘ liá»‡u trÃªn chÃºng ta nháº­n tháº¥y $P(out = overcast\|No) = 0$, khi Ä‘Ã³ chÃºng ta thá»±c hiá»‡n tÃ­nh xÃ¡c suáº¥t khÃ´ng chÆ¡i tennis sáº½ báº±ng 0 dÃ¹ cho nhiá»‡t Ä‘á»™, Ä‘á»™ áº©m, giÃ³ lÃ  tháº¿ nÃ o. Äá»ƒ trÃ¡nh trÆ°á»ng há»£p nÃ y xáº£y ra kháº£ nÄƒng (likelihood) cá»§a chÃºng ta sáº½ Ä‘Æ°á»£c tÃ­nh nhÆ° sau:

$P(out=overcast\|Yes) = \frac{Sá»‘\\:láº§n\\:outlook\\:lÃ \\:overcast\\:vÃ \\:khÃ´ng\\:chÆ¡i\\:tennis + \alpha }{Tá»•ng\\:sá»‘\\:láº§n\\:khÃ´ng\\:chÆ¡i\\:tennis + \alpha\times K}$

Trong Ä‘Ã³ $\alpha$ lÃ  báº­c (degree) cá»§a smoothing, K lÃ  sá»‘ nhÃ³m (class) cá»§a biáº¿n phá»¥ thuá»™c (dependent variable)

Trong trÆ°á»ng há»£p $\alpha = 1$, chÃºng ta cÃ³ thá»ƒ gá»i lÃ  add-one smoothing. Thá»­ Ã¡p dá»¥ng cÃ¡c con sá»‘ Ä‘á»ƒ tÃ­nh $(out = overcast\|No)$ sau khi smoothing nhÃ©:

$P(out=overcast\|Yes) = \frac{0 + 1}{5 + 1\times2} = 0.14$

Má»™t lÆ°u Ã½ nhá» lÃ  chÃºng ta cÅ©ng sáº½ cáº§n Ã¡p dá»¥ng Laplace Smoothing vá»›i cÃ¡c kháº£ nÄƒng (likelihood) khÃ¡c khi tÃ­nh xÃ¡c suáº¥t chÆ¡i vÃ  khÃ´ng chÆ¡i tennis.

## Kernel Density

Trong bÃ i toÃ¡n cÃ³ sá»­ dá»¥ng biáº¿n dáº¡ng sá»‘ (numerical variable) nhÆ° trÃªn, chÃºng ta Ä‘ang giáº£ Ä‘á»‹nh ráº±ng chÃºng Ä‘Æ°á»£c phÃ¢n phá»‘i chuáº©n (normal distribution). Tuy nhiÃªn giáº£ Ä‘á»‹nh nÃ y cÃ³ thá»ƒ sai so vá»›i phÃ¢n phá»‘i thá»±c táº¿, trong trÆ°á»ng há»£p Ä‘Ã³ Ä‘á»ƒ cáº£i thiá»‡n hiá»‡u nÄƒng chÃºng ta cÃ³ thá»ƒ sá»­ dá»¥ng phÆ°Æ¡ng phÃ¡p Æ°á»›c lÆ°á»£ng Kernel Density (Kernel Density Estimation - KDE). Khi Ä‘Ã³ máº­t Ä‘á»™ xÃ¡c suáº¥t (probability density) sáº½ Ä‘Æ°á»£c estimate theo KDE vÃ  sá»­ dá»¥ng khi tÃ­nh toÃ¡n, giÃºp tÄƒng Ä‘á»™ chÃ­nh xÃ¡c cá»§a model.

## Káº¿t

NhÆ° váº­y trong bÃ i há»c ngÃ y hÃ´m nay chÃºng ta Ä‘Ã£ lÃ m quen vá»›i phÃ¢n loáº¡i NaÃ¯ve Bayes, má»™t phÃ¢n loáº¡i khÃ¡ Ä‘áº·c biá»‡t vÃ¬ viá»‡c huáº¥n luyá»‡n (training) Ä‘Æ°á»£c dá»±a trÃªn viá»‡c tÃ­nh toÃ¡n nhá»¯ng giÃ¡ trá»‹ cá»§a cÃ¡c cÃ¡ thá»ƒ (instance). Do Ä‘áº·c tÃ­nh nÃ y mÃ  má»™t NaÃ¯ve Bayes model cÃ³ thá»ƒ Ä‘Æ°á»£c huáº¥n luyá»‡n ngay vá»›i cáº£ má»™t táº­p dá»¯ liá»‡u (dataset) nhá». á» bÃ i há»c sau chÃºng ta sáº½ thá»±c hÃ nh triá»ƒn khai má»™t NaÃ¯ve Bayes model báº±ng Python, hÃ£y Ä‘Ã³n Ä‘á»c nhÃ© ğŸ’ª .